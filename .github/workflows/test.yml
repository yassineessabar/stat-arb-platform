name: Test Workflow Setup

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  test-setup:
    name: Test Basic Setup
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: Check Python Version
        run: |
          python3 --version
          pip3 --version

      - name: Check Repository Structure
        run: |
          echo "üìÅ Repository Structure:"
          ls -la
          echo ""
          echo "üìÇ Core Strategy Files:"
          ls -la core/ || echo "Core directory not found"
          echo ""
          echo "üìÇ Config Files:"
          ls -la config/ || echo "Config directory not found"
          echo ""
          echo "üìÇ Dashboard Files:"
          ls -la dashboard/ || echo "Dashboard directory not found"

      - name: Check for Required Files
        run: |
          echo "‚úÖ Checking required files..."

          # Check strategy executor
          if [ -f "dashboard/strategy_executor.py" ]; then
            echo "‚úÖ strategy_executor.py found"
            head -20 dashboard/strategy_executor.py
          else
            echo "‚ùå strategy_executor.py not found"
          fi

          # Check config
          if [ -f "config/params_v6.yaml" ]; then
            echo "‚úÖ params_v6.yaml found"
            head -20 config/params_v6.yaml
          else
            echo "‚ùå params_v6.yaml not found"
          fi

      - name: Test Python Imports
        run: |
          python3 << 'EOF'
          import sys
          import os
          print("‚úÖ Python imports test...")

          # Add paths
          sys.path.insert(0, 'dashboard')
          sys.path.insert(0, '.')

          try:
              # Test basic imports
              import json
              import asyncio
              from pathlib import Path
              print("‚úÖ Basic imports successful")

              # Test if strategy files exist
              if os.path.exists('dashboard/strategy_executor.py'):
                  print("‚úÖ Strategy executor found at dashboard/strategy_executor.py")

              if os.path.exists('core/strategy_engine.py'):
                  print("‚úÖ Strategy engine found at core/strategy_engine.py")

          except ImportError as e:
              print(f"‚ùå Import error: {e}")
              sys.exit(1)

          print("\n‚úÖ All basic tests passed!")
          EOF

      - name: Check Secrets Configuration
        run: |
          echo "üìã Checking configured secrets..."
          echo ""

          # Check which secrets are set (without revealing values)
          if [ -n "${{ secrets.BINANCE_TESTNET_KEY }}" ]; then
            echo "‚úÖ BINANCE_TESTNET_KEY is configured"
          else
            echo "‚ö†Ô∏è BINANCE_TESTNET_KEY is NOT configured"
          fi

          if [ -n "${{ secrets.BINANCE_TESTNET_SECRET }}" ]; then
            echo "‚úÖ BINANCE_TESTNET_SECRET is configured"
          else
            echo "‚ö†Ô∏è BINANCE_TESTNET_SECRET is NOT configured"
          fi

          if [ -n "${{ secrets.SUPABASE_URL }}" ]; then
            echo "‚úÖ SUPABASE_URL is configured"
          else
            echo "‚ö†Ô∏è SUPABASE_URL is NOT configured (optional)"
          fi

          if [ -n "${{ secrets.SUPABASE_SERVICE_KEY }}" ]; then
            echo "‚úÖ SUPABASE_SERVICE_KEY is configured"
          else
            echo "‚ö†Ô∏è SUPABASE_SERVICE_KEY is NOT configured (optional)"
          fi

          echo ""
          echo "üìå To add secrets:"
          echo "1. Go to Settings ‚Üí Secrets and variables ‚Üí Actions"
          echo "2. Click 'New repository secret'"
          echo "3. Add the secret name and value"

      - name: Summary
        run: |
          echo "=========================================="
          echo "  WORKFLOW TEST SUMMARY"
          echo "=========================================="
          echo "‚úÖ GitHub Actions is working!"
          echo "‚úÖ Python environment is set up"
          echo "‚úÖ Repository structure is correct"
          echo ""
          echo "Next steps:"
          echo "1. Add your API secrets (see above)"
          echo "2. The strategy will run automatically every 5 minutes"
          echo "3. Check the 'Actions' tab to monitor execution"
          echo ""
          echo "üöÄ Your v6 strategy is ready for deployment!"