# GitLab CI Alternative (runs in EU)
# Copy this to .gitlab-ci.yml in GitLab project

variables:
  PYTHON_VERSION: "3.10"

stages:
  - trade

execute_strategy:
  stage: trade
  image: python:$PYTHON_VERSION

  before_script:
    - pip install -r dashboard/requirements.txt

  script:
    # Test Binance access from GitLab EU servers
    - curl -s "https://api.binance.com/api/v3/ping" || echo "Binance blocked"
    - curl -s "https://testnet.binance.vision/api/v3/ping" || echo "Testnet blocked"

    # Create config
    - |
      cat > strategy_config.json << EOF
      {
        "strategy_name": "StatArb_v6_GitLab",
        "trading_mode": "${TRADING_MODE:-paper}",
        "universe": ["BTCUSDT", "ETHUSDT", "BNBUSDT"],
        "portfolio_value": 10000,
        "api_key": "${BINANCE_TESTNET_KEY}",
        "api_secret": "${BINANCE_TESTNET_SECRET}",
        "testnet": true
      }
      EOF

    # Run strategy
    - cd dashboard && python3 strategy_executor.py --config ../strategy_config.json

  rules:
    - if: $CI_PIPELINE_SOURCE == "schedule"  # Scheduled execution
    - if: $CI_PIPELINE_SOURCE == "web"       # Manual trigger

# Schedule in GitLab: CI/CD > Schedules > New schedule > */5 * * * * (every 5 minutes)